{% extends "base.html" %}
{% block content %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script src="{{ url_for('static', filename='js/socketio.js') }}"></script>
<script src="{{ url_for('static', filename='js/note_edit.js') }}"></script>
<script type="text/javascript" charset="utf-8">
    
</script>

<form id="note_form">
    <input type=hidden id='note_user_id', name='note_user_id', value='{{current_user.id}}'>
    <input type=hidden id='note_game_id', name='note_game_id', value='{{id}}'>
    <label for='note_note'>Note:</label>
    <textarea id='note_note' required autocomplete='off' type='textarea' placeholder='Collaborative note'></textarea>
    <br/>
    <label for='note_private'>Note is private(The GM will still be able to see it):</label>
    <input type='checkbox' id='note_private', name='note_private', value='n'>
    <br/>
    <label for='note_in_characer'>Note is written in character:</label>
    <input type='checkbox' id='note_in_character', name='note_in_character', value='n'><br/>
    <input id='note_submit' type='submit' value='Submit' name='note_submit'>

</form>
<br/>
<br/>
{% if dmid == current_user.id %}
    
    <button id='new_session_button'>Start a new session?</button>
    <div id='new_session_form_div'></div>
{% endif %}

<div id="Session Cards">
{% if session_titles %}
    {% for session in session_titles %}
        <div class="sessions border shadow-lg p-3 mb-5 bg-light rounded" id="session_header_{{session.id}}">
            <h2>Session {{session.number}}: {{session.title}}</h2>
            <div id="session_card_{{session.number}}">
                {% if typ(note_dict[session.number]) == lis %}
                    <ul>
                    {% for note in note_dict[session.number] %}
                        <!-- <span id='note_span_{{note.id}}_{{note.user_id}}'> -->
                            <li>
                            <span id='note_{{note.id}}'>
                                {{ note.date_added }} || <b>{{ note.charname }}:</b> 
                                <span id='inner_{{note.id}}'>{{ note.note }}</span>
                            </span>
                            {% if note.user_id == current_user.id %}
                            <a id='edit_{{note.id}}' ><img class='note_edit_button' data-id='{{note.id}}_{{note.private}}_{{note.in_character}}' src={{edit_img}}></a>
                            {% endif %}
                            
                            </li>
                        <!-- </span> -->
                    {% endfor %}
                    </ul>
                {% else %}
                    <!-- <span id='note_span_{{note_dict[st(session.number)].id}}_{{note_dict[session.number].user_id}}'> -->
                        <ul>
                            <li>
                        <span id='note_{{note_dict[session.number].id}}'>
                            {{ note_dict[session.number].date_added }} || <b>{{ note_dict[session.number].charname }}:</b> 
                            <span id='inner_{{note.id}}'>{{ note_dict[session.number].note }}</span>
                        </span>
                        {% if note.user_id == current_user.id %}
                        <a id='edit_{{note_dict[session.number].id}}'><img class='note_edit_button' data-id='{{note_dict[session.number].id}}_{{note_dict[session.number].private}}_{{note_dict[session.number].in_character}}' src={{edit_img}}></a>
                        {% endif %}
                        
                        </li>
                        </ul>
                    <!-- </span> -->

                {% endif %}
            </div>
        </div>
    {% endfor %}
{% endif %}
</div>
{% include 'note_contextual_menu.html' %}
{% endblock %}