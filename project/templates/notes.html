{% extends "base.html" %}
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
// function new_session_func() {
//     let test = document.getElementById("new_session_form_div")
//     test.innerHTML = "<h2>Session Info</h2><form onsubmit='send_new_session_func()'><input id='new_session_form_hidden' type='hidden' value='{{current_user.id}}'><input id='new_session_form_number' required, type='number', min='{{session_titles[0].number+1}}', placeholder='{{session_titles[0].number+1}}'><input id='new_session_form_title' required, type='text', placeholder='Title of New Session'><input id='new_session_form_sysnopsis' type='text', placeholder='Optional Synopsis'><button id='new_session_form_submit'>Make Session</button></form>"
// }

    // function send_new_session_func() {
    //     socket.emit('send_new_session', form.value, hidden.value)
    //     console.log('new session function');
    //     return false
    // }

    function fill_new_session_func(new_card) {
        session_cards = document.getElementById('Session Cards')
        session_cards.insertAdjacentHTML('afterbegin', new_card)
        console.log('new card')
        console.log(new_card)
    }



    document.addEventListener("DOMContentLoaded", function(event) { 
        const socket = io('http://127.0.0.1:5000')
        const evt = new Event("NewSessionFormCreated", {"bubbles":true, "cancelable":false})
        
        socket.on('fill_new_session', function(new_card) {
            console.log('fill_new_session')
            console.log(new_card)
            session_cards = document.getElementById('Session Cards')
            session_cards.insertAdjacentHTML('afterbegin', new_card)
        });
        // create form for making new session card
        document.getElementById("new_session_button").onclick = function() {
            document.getElementById("new_session_form_div").innerHTML = "<h2>Session Info</h2><form id ='new_session_form'><input id='new_session_form_id' type='hidden' value='{{id}}'><input id='new_session_form_number' required, type='number', min='{{session_titles[0].number+1}}', placeholder='{{session_titles[0].number+1}}'><input id='new_session_form_title' required, type='text', placeholder='Title of New Session'><input id='new_session_form_synopsis' type='text', placeholder='Optional Synopsis'><button id='new_session_form_submit'>Make Session</button></form>"
            var new_session_form_id = document.getElementById('new_session_form_id')
            var new_session_form_number = document.getElementById('new_session_form_number')
            var new_session_form_title = document.getElementById('new_session_form_title')
            var new_session_form_synopsis = document.getElementById('new_session_form_synopsis')
            var new_session_form_submit = document.getElementById('new_session_form_submit')
            console.log(new_session_form_number)
            document.dispatchEvent(evt);
        }

    })

    document.addEventListener("NewSessionFormCreated", function(event) {
        const socket = io('http://127.0.0.1:5000')
        document.getElementById('new_session_form').onsubmit = function() {
            console.log('newsessionform')
            console.log(new_session_form_number.value)
            socket.emit('send_new_session', new_session_form_id.value, new_session_form_number.value, new_session_form_title.value, new_session_form_synopsis.value)

            return false
        }
    })





        // list = document.getElementById("notes");
        // document.getElementById("sessionsubmit").onsubmit = function () {

        // }
        // var list = document.getElementById("notes")
        // socket.on('connect', function() {
        //     console.log('connected log')
        //     socket.send('I\'m connected!');
        // });
        // form.onsubmit = function() {
        //     console.log('form submit push log');
        //     socket.emit('push');
        // };
    //     socket.on('filltest', function(ob) {
    //         console.log('fill log');
    //         console.log(ob);
    //         list.insertAdjacentHTML('afterbegin', ob);
        // });
    
</script>



{% if dmid == current_user.id %}
    <button id='new_session_button'>Start a new session?</button>
    <div id='new_session_form_div'></div>



{% endif %}
<div id="Session Cards">
{% if session_titles %}
    {% for session in session_titles %}
        <div>Session{{session.number}}: {{session.title}}</div>
            {% for note in logs[session.number - 1] %}
                <p><b>{{ note.charname }}:</b> {{ note.note }} ... {{ note.date_added }}</p>
            {% endfor %}
    {% endfor %}
{% endif %}
</div>
{% endblock %}